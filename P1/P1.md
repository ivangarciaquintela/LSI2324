# PRACTICA 1 LSI
## Parte 1
<details>
  <summary>a) Configure su máquina virtual de laboratorio con los datos proporcionados por el profesor. Analice los ficheros básicos de configuración (interfaces, hosts, resolv.conf, nsswitch.conf, sources.list, etc.)</summary>

  Respuesta:

  1. Archivo de interfaces( /etc/network/interfaces):
     ```
     auto lo ens33 ens34
     iface lo inet loopback
     iface ens33 inet static
     	address 10.11.48.71
     	netmask 255.255.254.0
     	broadcast 10.11.49.255
     	network 10.11.48.0
     	gateway 10.11.48.1
     iface ens34 inet static
     	address 10.11.50.71
     	netmask 255.255.254.0
     	broadcast 10.11.51.255
     	network 10.11.50.0
     ```
  2. Archivo hosts (/etc/hosts): 
     ```
     127.0.0.1       localhost
     127.0.1.1       debian
     # The following lines are desirable for IPv6 capable hosts
     ::1     localhost ip6-localhost ip6-loopback
     ff02::1 ip6-allnodes
     ff02::2 ip6-allrouters
     ```

  3. Archivo resolv.conf:
     ```
     main udc.pri
     search udc.pri
     nameserver 10.8.12.49
     nameserver 10.8.12.50
     nameserver 10.8.12.47
     ```

  4. Archivo nsswitch.conf(/etc/nssiwtch.conf):
     ```
     passwd:         files systemd
     group:          files systemd
     shadow:         files
     gshadow:        files

     hosts:          files mdns4_minimal [NOTFOUND=return] dns myhostname
     networks:       files

     protocols:      db files
     services:       db files
     ethers:         db files
     rpc:            db files
     netgroup:       nis
     ```
   5. Archivo sources.list (/etc/apt/sources.list) :
      ```
      deb http://deb.debian.org/debian/ buster main
      deb-src http://deb.debian.org/debian/ buster main

      deb https://deb.debian.org/debian-security buster-security main contrib
      deb-src https://deb.debian.org/debian-security buster-security main contrib

      deb http://security.debian.org/debian-security buster/updates main
      deb-src http://security.debian.org/debian-security buster/updates main

      ```
</details>
<details>
  <summary>b)¿Qué distro y versión tiene la máquina inicialmente entregada?. Actualice su máquina a la última versión estable disponible.</summary>

  Respuesta:

  1. Mostramos la distro actual y su versión:
     ```console
     root@debian:/home/lsi# lsb_release -a
     Distributor ID:	Debian
     Description:	Debian GNU/Linux 10 (buster)
     Release:	10
     Codename:	buster
     ```
  2. Para actualizar (desde el usuario 'root'):
  ```console
   root@debian:/home/lsi# apt update -y && apt upgrade -y
   root@debian:/home/lsi# apt dist-upgrade
  ```
  3. Tras ello será necesario reemplazar el sources.list hacia la versión que queremos ,en este caso debian 12 (bookworm), para ello deberemos hacer este paso dos veces ya que primero deberíamos pasar por debian 11 (bullseye). El archivo quedará finalmente así (debian 12):
  ```
      deb https://ftp.debian.org/debian/ bookworm contrib main non-free non-free-firmware
      # deb-src https://ftp.debian.org/debian/ bookworm contrib main non-free non-free-firmware

      deb https://ftp.debian.org/debian/ bookworm-updates contrib main non-free non-free-firmware
      # deb-src https://ftp.debian.org/debian/ bookworm-updates contrib main non-free non-free-firmware

      deb https://ftp.debian.org/debian/ bookworm-proposed-updates contrib main non-free non-free-firmware
      # deb-src https://ftp.debian.org/debian/ bookworm-proposed-updates contrib main non-free non-free-firmwa>

      deb https://ftp.debian.org/debian/ bookworm-backports contrib main non-free non-free-firmware
      # deb-src https://ftp.debian.org/debian/ bookworm-backports contrib main non-free non-free-firmware

      deb https://security.debian.org/debian-security/ bookworm-security contrib main non-free non-free-firmwa>
      # deb-src https://security.debian.org/debian-security/ bookworm-security contrib main non-free non-free->
  ```
  4. Ejecutamos los siguientes comandos y lo tendremos actualizado:
   ```console
   root@debian:/home/lsi# apt update 
   root@debian:/home/lsi# apt upgrade --without-new-pkgs
   root@debian:/home/lsi# apt full-upgrade
   root@debian:/home/lsi# reboot
  ```
</details>
<details>
  <summary> c) Identifique la secuencia completa de arranque de una máquina basada en la distribución de referencia (desde la pulsación del botón de arranque hasta la pantalla de login). ¿Qué target por defecto tiene su máquina?. ¿Cómo podría cambiar el target de arranque?. ¿Qué targets tiene su sistema y en qué estado se encuentran?. ¿Y los services?. Obtenga la relación de servicios de su sistema y su estado. ¿Qué otro tipo de unidades existen?.</summary>

  1. Para ello primero ejecutaremos:
     ```console
     root@debian:/home/lsi# systemctl list-dependencies default.target
     ```
  2. Target por defecto es `graphical.target`, para cambiarlo debemos hacer:
     ```console
     root@debian:/home/lsi# systemctl set-default TARGET
     ```
  3. Los targets del sistema podemos obtenerlos usando el comando 'systemctl list-unit-files --type=target'
  
  4. Cambiaremos el target a 'multi-user.target' ya que el 'graphical.target' no lo necesitaremos :
     ```console
     root@debian:/home/lsi# systemctl set-default multi-user.target
     ```
  5. Para listar a los Servicios del sistema
     ```console
     root@debian:/home/lsi# systemctl list-unit-files --type=service
     ```
</details>
<details>
  <summary>d) Determine los tiempos aproximados de botado de su kernel y del userspace. Obtenga la relación de los tiempos de ejecución de los services de su sistema.</summary>

  1.  Para obtener tiempos aproximados de botado de kernel y userspace:
      ```console
      root@debian:/home/lsi# systemd-analyze
      Startup finished in 4.163s (kernel) + 9.272s (userspace) = 13.436s
      multi-user.target reached after 9.229s in userspace.
      ```
   2. Para tener los tiempo específicos de cada proceso en el boot:
   ```console
   root@debian:/home/lsi# systemd-analyze blame
	4.060s e2scrub_reap.service
	2.624s ifupdown-pre.service
	2.578s dev-sda1.device
	2.410s ModemManager.service
	2.381s NetworkManager.service
	2.356s apparmor.service
	2.127s networking.service
	1.121s user@1000.service
	 829ms systemd-journal-flush.service
	 821ms systemd-udev-trigger.service
	 789ms systemd-timesyncd.service
	 734ms systemd-journald.service
	 713ms systemd-udevd.service
	 670ms keyboard-setup.service
	 664ms polkit.service
	 646ms udisks2.service
	 574ms avahi-daemon.service
	 536ms NetworkManager-wait-online.service
	 526ms dbus.service
	 510ms systemd-logind.service
	 404ms systemd-binfmt.service
	 332ms systemd-tmpfiles-setup.service
	 310ms systemd-modules-load.service
	 274ms cups.service
	 241ms ssh.service
	 219ms rsyslog.service
	 205ms plymouth-start.service
	 195ms pulseaudio-enable-autospawn.service
	 190ms systemd-random-seed.service
	 188ms dev-mqueue.mount
	 188ms sys-kernel-debug.mount
	 187ms sys-kernel-tracing.mount
	 181ms wpa_supplicant.service
	 179ms dev-hugepages.mount
	 160ms systemd-sysusers.service
	 138ms modprobe@dm_mod.service
	 137ms systemd-tmpfiles-setup-dev.service
	 130ms upower.service
	 118ms systemd-update-utmp.service
	....
   ```	
</details>

<details>
	<summary>
	e) Investigue si alguno de los servicios del sistema falla. Pruebe algunas de las opciones del sistema de registro journald. Obtenga toda la información journald referente al proceso de botado de la máquina. ¿Qué hace el systemd-timesyncd?.
	</summary>
</details>


<details>
	<summary>
	f) Identifique y cambie los principales parámetros de su segundo interface de red (ens34). Configure un segundo interface lógico. Al terminar, déjelo como estaba.
	</summary>

</details>


<details>
	<summary>
	g) ¿Qué rutas (routing) están definidas en su sistema?. Incluya una nueva ruta estática a una determinada red.
	</summary>
</details>


<details>
	<summary>
	h) En el apartado d) se ha familiarizado con los services que corren en su sistema. ¿Son necesarios todos ellos?. Si identifica servicios no necesarios, proceda adecuadamente. Una limpieza no le vendrá mal a su equipo, tanto desde el punto de vista de la seguridad, como del rendimiento.
	</summary>
</details>


<details>
	<summary>
	i) Diseñe y configure un pequeño “script” y defina la correspondiente unidad de tipo service para que se ejecute en el proceso de botado de su máquina.
	</summary>
</details>



<details>
	<summary>
	j) Identifique las conexiones de red abiertas a y desde su equipo.
	</summary>
</details>

<details>
	<summary>
	k) Nuestro sistema es el encargado de gestionar la CPU, memoria, red, etc., como soporte a los datos y procesos. Monitorice en “tiempo real” la información relevante de los procesos del sistema y los recursos consumidos. Monitorice en “tiempo real” las conexiones de su sistema.
	</summary>
</details>

<details>
	<summary>
	l) Un primer nivel de filtrado de servicios los constituyen los tcp-wrappers. Configure el tcp-wrapper de su sistema (basado en los ficheros hosts.allow y hosts.deny) para permitir conexiones SSH a un determinado conjunto de IPs y denegar al resto. ¿Qué política general de filtrado ha aplicado?. ¿Es lo mismo el tcp-wrapper que un firewall?. Procure en este proceso no perder conectividad con su máquina. No se olvide que trabaja contra ella en remoto por ssh.
	</summary>
</details>


<details>
	<summary>
	m) Existen múltiples paquetes para la gestión de logs (syslog, syslog-ng, rsyslog). Utilizando el rsyslog pruebe su sistema de log local. Pruebe también el journald.
	</summary>
</details>



<details>
	<summary>
	n) Configure IPv6 6to4 y pruebe ping6 y ssh sobre dicho protocolo. ¿Qué hace su tcp-wrapper en las conexiones ssh en IPv6? Modifique su tcp-wapper siguiendo el criterio del apartado h).¿Necesita IPv6?. ¿Cómo se deshabilita IPv6 en su equipo?
	</summary>
</details>


## Parte 2
<details>
<summary>
	a) En colaboración con otro alumno de prácticas, configure un servidor y un cliente NTPSec básico.
</summary>
 
</details>

<details>
<summary>
b) Cruzando los dos equipos anteriores, configure con rsyslog un servidor y un cliente de logs.	
</summary>
 
</details>

<details>
<summary>
c) Haga todo tipo de propuestas sobre los siguientes aspectos.: ¿Qué problemas de seguridad identifica en los dos apartados anteriores?. ¿Cómo podría solucionar los problemas identificados?
</summary>
</details>

<details>
<summary>
d) En la plataforma de virtualización corren, entre otros equipos, más de 200 máquinas virtuales para LSI. Como los recursos son limitados, y el disco duro también, identifique todas aquellas acciones que pueda hacer para reducir el espacio de disco ocupado.
</summary>
 
</details>
<details>
<summary>
e) Instale el SIEM splunk en su máquina. Sobre dicha plataforma haga los siguientes puntos.:
</summary>
<details>
	<summary> a. Genere una query que visualice los logs internos del splunk		
	</summary>
</details>

<details>
	<summary> b. Cargué el fichero /var/log/apache2/access.log y el journald del sistema y visualícelos.
	</summary>
</details>

<details>
	<summary> c. Obtenga las IPs de los equipos que se han conectado a su servidor web (pruebe a generar algún tipo de gráfico de visualización), así como las IPs que se han conectado un determinado día de un determinado mes.		
	</summary>
</details>

<details>
	<summary>
		d. Trate de obtener el país y región origen de las IPs que se han conectado a su servidor web y si posible sus coordenadas geográficas.		
	</summary>
</details>

 <details>
	 <summary>
		 e. Obtenga los hosts origen, sources y sourcestypes.
	 </summary>
 </details>
 
 <details>
	 <summary>
		f. ¿cómo podría hacer que splunk haga de servidor de log de su cliente?
	 </summary>
 </details>
</details>




